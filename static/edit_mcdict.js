(()=>{"use strict";function t(t){let e={};var n;e.hex=(n=t.text(),Array.from((new TextEncoder).encode(n)).map((t=>t.toString(16))).join("")),e.var="default";let i=t.attr("mathvariant");null!=i&&(e.var="normal"==i?"roman":i);let a=t.data("math-concept");return null!=a&&(e.concept=Number(a)),e}let e=0,n={};$.ajax({url:"/mcdict.json",dataType:"json",async:!1,success:function(t){e=t[0],n=t[1]}});let i=["#008b8b","#ff7f50","#ff4500","#2f4f4f","#006400","#dc143c","#c71585","#4169e1","#2e8b57","#ff1493","#191970","#ff69b4","#ff69b4","#0000cd","#f4a460","#ff00ff","#7cfc00","#d2691e","#a0522d","#800000","#9400d3","#556b2f","#4b0082","#808000"],a=0;for(let t in n)for(let e in n[t])for(let r in n[t][e])null!=n[t][e][r].description&&(n[t][e][r].color=i[a%i.length],a++);let r={};function l(e){let i=[];e.is("mi")&&null!=function(t){if(null!=n[t.hex])return n[t.hex][t.var]}(t(e))&&(i=[e]);for(let t=0;t<e.children().length;t++){let n=e.children().eq(t);i=i.concat(l(n))}return i}$.ajax({url:"/sog.json",dataType:"json",async:!1,success:function(t){r=t}}),$((function(){0!=$("#error-message").text().length&&$("#error-dialog").dialog({dialogClass:"error-dialog",modal:!0,title:"Error",buttons:{OK:function(){$(this).dialog("close")}}})}));let o=[];function c(t,e){let n=0,i=0;for(let a of o)a.hex==t&&a.var==e&&(i+=1,null!=a.concept&&(n+=1));return[n,i]}function d(t,e,n){let i=0;for(let a of o)a.hex==t&&a.var==e&&null!=a.concept&&a.concept==n&&(i+=1);return i}function f(e,n,i){let a=0;for(let l of r.sog){let r=t($("#"+l.mi_id.replace(/[ !"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~]/g,"\\$&")));r.hex==e&&r.var==n&&null!=r.concept&&r.concept==i&&(a+=1)}return a}function h(t){let e=Array();for(let n=0;n<t.length;n+=2)e.push(parseInt(t.slice(n,n+2),16));return(new TextDecoder).decode(new Uint8Array(e))}$((function(){for(let e of l($(":root")))o.push(t(e))})),$((function(){let t="";for(let e in n)for(let i in n[e]){let a=h(e),r="";r="default"!=i?`<math><mi mathvariant=${i}>${a}</mi></math>`:`<math><mi>${a}</mi></math>`;let l="";if(0==n[e][i].length){let t=c(e,i);l=`<tr><td align="center">${r}</td><td>${t[0]}/${t[1]}</td><td colspan="6">No candidate concepts</td></tr>`}else{let t=0;for(let a in n[e][i]){let o=n[e][i][a];if(null!=o.description){let h="NONE";o.affixes.length>0&&(h=o.affixes.join(", "));let u="";if(0==t){let t=c(e,i),a=t[0],l=t[1];u=`<td  align="center" rowspan="${n[e][i].length}">${r}</td><td  align="center" rowspan="${n[e][i].length}">${a}/${l}</td>`}let p=d(e,i,Number(a)),s=f(e,i,Number(a));l+=`<tr>${u}<td>${o.description}</td><td>${h}</td><td align="right">${o.arity}</td><td align="right">${p}</td><td align="right">${s}</td><td><a class="edit-concept-mcdict" data-idf-hex="${e}" data-idf-var="${i}" data-concept="${a}" href="javascript:void(0);">edit</a></td></tr>`,t+=1}}}t+=l}let i=`<table border="1" cellpadding="5"><tr><th>Identifier</th><th>Progress</th><th>Description</th><th>Affix</th><th>Arity</th><th>#Occur</th><th>#Sog</th><th>Edit</th></tr>${t}</table>`;$("#edit-mcdict-box").html(i),$("a.edit-concept-mcdict").on("click",(function(){let t=$(this).attr("data-idf-hex"),i=$(this).attr("data-idf-var"),a=$(this).attr("data-concept");!function(t,i){let a=$("#concept-dialog-template").clone();a.removeAttr("id");let r=a.find("#concept-form");r.attr("action","/_update_concept_for_edit_mcdict");let l=n[t.hex][t.var][i];r.find("textarea").text(l.description),r.find('input[name="arity"]').attr("value",l.arity),l.affixes.forEach((function(t,e){r.find(`select[name="affixes${e}"]`).find(`option[value="${t}"]`).prop("selected",!0)})),a.dialog({modal:!0,title:"Edit Concept",width:500,buttons:{OK:function(){localStorage.scroll_top=$(window).scrollTop(),r.append(`<input type="hidden" name="mcdict_edit_id" value="${e}" />`),r.append(`<input type="hidden" name="idf_hex" value="${t.hex}" />`),r.append(`<input type="hidden" name="idf_var" value="${t.var}" />`),r.append(`<input type="hidden" name="concept_id" value="${i}" />`),r.trigger("submit")},Cancel:function(){$(this).dialog("close")}}})}({hex:t,var:i,concept:a},Number(a))}))}))})();