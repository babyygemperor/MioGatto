(()=>{"use strict";function t(t){let e={};var n;e.hex=(n=t.text(),Array.from((new TextEncoder).encode(n)).map((t=>t.toString(16))).join("")),e.var="default";let i=t.attr("mathvariant");null!=i&&(e.var="normal"==i?"roman":i);let a=t.data("math-concept");return null!=a&&(e.concept=Number(a)),e}function e(n){let a=[];n.is("mi")&&null!=function(t){if(null!=i[t.hex])return i[t.hex][t.var]}(t(n))&&(a=[n]);for(let t=0;t<n.children().length;t++){let i=n.children().eq(t);a=a.concat(e(i))}return a}let n=0,i={};$.ajax({url:"/mcdict.json",dataType:"json",async:!1,success:function(t){n=t[0],i=t[1]}});let a=["#008b8b","#ff7f50","#ff4500","#2f4f4f","#006400","#dc143c","#c71585","#4169e1","#2e8b57","#ff1493","#191970","#ff69b4","#ff69b4","#0000cd","#f4a460","#ff00ff","#7cfc00","#d2691e","#a0522d","#800000","#9400d3","#556b2f","#4b0082","#808000"],o=0;for(let t in i)for(let e in i[t])for(let n in i[t][e])null!=i[t][e][n].description&&(i[t][e][n].color=a[o%a.length],o++);let r={};$.ajax({url:"/sog.json",dataType:"json",async:!1,success:function(t){r=t}}),$((function(){0!=$("#error-message").text().length&&$("#error-dialog").dialog({dialogClass:"error-dialog",modal:!0,title:"Error",buttons:{OK:function(){$(this).dialog("close")}}})}));let l=[];function c(t,e){let n=0,i=0;for(let a of l)a.hex==t&&a.var==e&&(i+=1,null!=a.concept&&(n+=1));return[n,i]}function d(t,e,n){let i=0;for(let a of l)a.hex==t&&a.var==e&&null!=a.concept&&a.concept==n&&(i+=1);return i}function f(e,n,i){let a=0;for(let o of r.sog){let r=t($("#"+o.mi_id.replace(/[ !"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~]/g,"\\$&")));r.hex==e&&r.var==n&&null!=r.concept&&r.concept==i&&(a+=1)}return a}function u(t){let e=Array();for(let n=0;n<t.length;n+=2)e.push(parseInt(t.slice(n,n+2),16));return(new TextDecoder).decode(new Uint8Array(e))}$((function(){for(let n of e($(":root")))l.push(t(n))})),$((function(){let t="";for(let e in i)for(let n in i[e]){let a=u(e),o="";o="default"!=n?`<math><mi mathvariant=${n}>${a}</mi></math>`:`<math><mi>${a}</mi></math>`;let r="";if(0==i[e][n].length){let t=c(e,n);r=`<tr><td align="center">${o}</td><td>${t[0]}/${t[1]}</td><td colspan="6">No candidate concepts</td></tr>`}else{let t=0;for(let a in i[e][n]){let l=i[e][n][a];if(null!=l.description){let u="NONE";l.affixes.length>0&&(u=l.affixes.join(", "));let h="";if(0==t){let t=c(e,n),a=t[0],r=t[1];h=`<td  align="center" rowspan="${i[e][n].length}">${o}</td><td  align="center" rowspan="${i[e][n].length}">${a}/${r}</td>`}let p=d(e,n,Number(a)),s=f(e,n,Number(a));r+=`<tr>${h}<td>${l.description}</td><td>${u}</td><td align="right">${l.arity}</td><td align="right">${p}</td><td align="right">${s}</td><td><a class="edit-concept-mcdict" data-idf-hex="${e}" data-idf-var="${n}" data-concept="${a}" href="javascript:void(0);">edit</a></td></tr>`,t+=1}}}t+=r}let e=`<table border="1" cellpadding="5"><tr><th>Identifier</th><th>Progress</th><th>Description</th><th>Affix</th><th>Arity</th><th>#Occur</th><th>#Sog</th><th>Edit</th></tr>${t}</table>`;$("#edit-mcdict-box").html(e),$("a.edit-concept-mcdict").on("click",(function(){let t=$(this).attr("data-idf-hex"),e=$(this).attr("data-idf-var"),a=$(this).attr("data-concept");!function(t,e){let a=$("#concept-dialog-template").clone();a.removeAttr("id");let o=a.find("#concept-form");o.attr("action","/_update_concept_for_edit_mcdict");let r=i[t.hex][t.var][e];o.find("textarea").text(r.description),o.find('input[name="arity"]').attr("value",r.arity),r.affixes.forEach((function(t,e){o.find(`select[name="affixes${e}"]`).find(`option[value="${t}"]`).prop("selected",!0)})),a.dialog({modal:!0,title:"Edit Concept",width:500,buttons:{OK:function(){localStorage.scroll_top=$(window).scrollTop(),o.append(`<input type="hidden" name="mcdict_edit_id" value="${n}" />`),o.append(`<input type="hidden" name="idf_hex" value="${t.hex}" />`),o.append(`<input type="hidden" name="idf_var" value="${t.var}" />`),o.append(`<input type="hidden" name="concept_id" value="${e}" />`),o.trigger("submit")},Cancel:function(){$(this).dialog("close")}}})}({hex:t,var:e,concept:a},Number(a))}))})),$((function(){$("button#back-to-index").button(),$("button#back-to-index").on("click",(function(){let t=$("#back-to-index-form");t.attr("action","/"),t.trigger("submit")}))}))})();